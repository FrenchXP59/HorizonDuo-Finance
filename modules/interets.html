<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculatrice d'Int√©r√™ts Compos√©s - HorizonDuo Finance</title>
    <link rel="stylesheet" href="../style.css">
    <link rel="icon" href="/assets/favicon.png" type="image/png" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-PV4JRXP2C6"></script>
    <script>
      if (!location.hostname.includes("localhost") && !location.hostname.includes("replit.app")) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-PV4JRXP2C6');
      }
    </script>
</head>
<body class="dark">
    <div class="back-nav">
        <a href="../index.html" class="back-button" aria-label="Retour √† l'accueil">
            ‚Üê
        </a>
    </div>

    <div class="calculator-container">
        <div class="calculator-header">
            <h1 class="calculator-title">üî¢ Calculatrice d'Int√©r√™ts Compos√©s</h1>
            <p class="calculator-subtitle">
                D√©couvrez comment votre argent peut cro√Ætre gr√¢ce au pouvoir des int√©r√™ts compos√©s
            </p>
        </div>

        <div class="calculator-content">
            <div class="input-section">
                <h3>Param√®tres de simulation</h3>
                
                <div class="form-group">
                    <label for="principal" class="form-label">Montant initial (‚Ç¨)</label>
                    <input type="number" id="principal" class="form-input" value="10000" min="100" step="100">
                    <small style="color: var(--text-secondary);">Le capital de d√©part que vous souhaitez investir</small>
                </div>

                <div class="form-group">
                    <label for="rate" class="form-label">Taux de rendement annuel (%)</label>
                    <input type="range" id="rateSlider" class="form-input" min="1" max="15" step="0.1" value="7">
                    <input type="number" id="rate" class="form-input" value="7" min="0" max="30" step="0.1" style="margin-top: 0.5rem;">
                    <small style="color: var(--text-secondary);">Rendement annuel moyen attendu (historiquement 7% pour les march√©s actions)</small>
                </div>

                <div class="form-group">
                    <label for="years" class="form-label">Dur√©e d'investissement (ann√©es)</label>
                    <input type="number" id="years" class="form-input" value="20" min="1" max="50">
                    <small style="color: var(--text-secondary);">Plus la dur√©e est longue, plus l'effet de capitalisation est puissant</small>
                </div>

                <div class="form-group">
                    <label for="monthly" class="form-label">√âpargne mensuelle (‚Ç¨) - Optionnel</label>
                    <input type="number" id="monthly" class="form-input" value="300" min="0" step="50">
                    <small style="color: var(--text-secondary);">Montant que vous ajoutez chaque mois √† votre investissement</small>
                </div>

                <button class="calculate-button" onclick="calculateAndDisplay()">
                    Calculer ma projection
                </button>
            </div>

            <div class="result-section">
                <h3>R√©sultats de la simulation</h3>
                <div id="results">
                    <div class="result-item">
                        <span class="result-label">Capital final :</span>
                        <span class="result-value" id="finalAmount">-</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Total vers√© :</span>
                        <span class="result-value" id="totalContributions">-</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Int√©r√™ts g√©n√©r√©s :</span>
                        <span class="result-value" id="totalInterest">-</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Multiplication du capital :</span>
                        <span class="result-value" id="multiplier">-</span>
                    </div>
                </div>

                <div style="margin-top: 2rem; padding: 1rem; background: var(--bg-primary); border-radius: 0.5rem;">
                    <h4 style="color: var(--accent-gold); margin-bottom: 0.5rem;">üí° Le saviez-vous ?</h4>
                    <p style="font-size: 0.9rem; color: var(--text-secondary);" id="educationalTip">
                        Les int√©r√™ts compos√©s sont consid√©r√©s comme la 8√®me merveille du monde par Albert Einstein !
                    </p>
                </div>
            </div>

            <div class="chart-container">
                <h3>√âvolution de votre capital</h3>
                <canvas id="compoundChart" width="400" height="200"></canvas>
            </div>
        </div>
    </div>

    <script src="../script.js"></script>
    <script>
        let chart = null;

        // Synchroniser les champs de taux
        document.getElementById('rateSlider').addEventListener('input', function() {
            document.getElementById('rate').value = this.value;
        });

        document.getElementById('rate').addEventListener('input', function() {
            document.getElementById('rateSlider').value = this.value;
        });

        // Calcul et affichage automatique
        document.querySelectorAll('.form-input').forEach(input => {
            input.addEventListener('input', calculateAndDisplay);
        });

        function calculateAndDisplay() {
            const principal = parseFloat(document.getElementById('principal').value) || 0;
            const rate = parseFloat(document.getElementById('rate').value) || 0;
            const years = parseInt(document.getElementById('years').value) || 0;
            const monthly = parseFloat(document.getElementById('monthly').value) || 0;

            if (principal <= 0 || years <= 0) return;

            const data = calculateCompoundInterest(principal, rate, years, monthly);
            const finalData = data[data.length - 1];

            // Afficher les r√©sultats
            document.getElementById('finalAmount').textContent = formatCurrency(finalData.amount);
            document.getElementById('totalContributions').textContent = formatCurrency(finalData.contributions);
            document.getElementById('totalInterest').textContent = formatCurrency(finalData.interest);
            document.getElementById('multiplier').textContent = `√ó${(finalData.amount / finalData.contributions).toFixed(1)}`;

            // Conseil √©ducatif personnalis√©
            updateEducationalTip(finalData.interest, finalData.contributions, years);

            // Mettre √† jour le graphique
            updateChart(data);
        }

        function updateEducationalTip(interest, contributions, years) {
            const interestPercentage = (interest / contributions) * 100;
            let tip = "";

            if (years >= 20) {
                tip = `Sur ${years} ans, les int√©r√™ts repr√©sentent ${interestPercentage.toFixed(0)}% de vos gains ! C'est le pouvoir du temps qui travaille pour vous.`;
            } else if (interestPercentage > 50) {
                tip = `Vos int√©r√™ts g√©n√®rent plus que vos versements ! C'est l'effet boule de neige des int√©r√™ts compos√©s.`;
            } else {
                tip = `Avec ${years} ans d'investissement, vous pourriez prolonger la dur√©e pour maximiser l'effet des int√©r√™ts compos√©s.`;
            }

            document.getElementById('educationalTip').textContent = tip;
        }

        function updateChart(data) {
            const ctx = document.getElementById('compoundChart').getContext('2d');

            if (chart) {
                chart.destroy();
            }

            const isDark = document.body.classList.contains('dark');

            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.map(d => `Ann√©e ${d.year}`),
                    datasets: [
                        {
                            label: 'Capital total',
                            data: data.map(d => d.amount),
                            borderColor: '#FFD700',
                            backgroundColor: 'rgba(255, 215, 0, 0.1)',
                            fill: true,
                            tension: 0.4,
                            borderWidth: 3
                        },
                        {
                            label: 'Contributions cumul√©es',
                            data: data.map(d => d.contributions),
                            borderColor: '#10B981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            fill: true,
                            tension: 0.4,
                            borderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            labels: {
                                color: isDark ? '#fefefe' : '#111827'
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + formatCurrency(context.parsed.y);
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                color: isDark ? '#d1d5db' : '#6b7280'
                            },
                            grid: {
                                color: isDark ? '#374151' : '#e5e7eb'
                            }
                        },
                        y: {
                            ticks: {
                                color: isDark ? '#d1d5db' : '#6b7280',
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            },
                            grid: {
                                color: isDark ? '#374151' : '#e5e7eb'
                            }
                        }
                    }
                }
            });
        }

        // Calcul initial
        calculateAndDisplay();

        // Gestion du th√®me pour le graphique
        document.addEventListener('DOMContentLoaded', function() {
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                        if (chart) {
                            calculateAndDisplay(); // Recr√©er le graphique avec les nouvelles couleurs
                        }
                    }
                });
            });

            observer.observe(document.body, {
                attributes: true,
                attributeFilter: ['class']
            });
        });
    </script>
</body>
</html>
